name: Anomalous Usage of Account Credentials
id: 629cbf9e-5785-11ec-9611-acde48001122
version: 1
date: '2021-12-07'
author: Lou Stella, Splunk
type: Anomaly
datamodel:
- Endpoint_Processes
description: This is an anomaly generating detection looking for multiple interactive
  logins within a specific time period. An insider threat may attempt to steal colleagues
  credentials in low tech, undetectable methods, in order to gain access to additional
  information or to hide their own behavior. This should capture their attempted use
  of those credentials on a workstation.
search: '| from read_ssa_enriched_events() | eval dest_device_id=ucast(map_get(input_event,
  "dest_device_id"), "string", null), authentication_type=ucast(map_get(input_event, "authentication_type"),
  "string", null), timestamp=parse_long(ucast(map_get(input_event, "_time"), "string",
  null)), dest_user_original_artifact=ucast(map_get(input_event, "dest_user_original_artifact"), "string",
  null), signature_id=ucast(map_get(input_event, "signature_id"), "string", null) | where
  signature_id="4624" | where authentication_type="2" OR authentication_type="11" | where NOT (dest_user_original_artifact="SYSTEM")
  AND NOT (dest_user_original_artifact="ANONYMOUS LOGON") | stats estdc(dest_user_original_artifact) AS dest_user_original_artifact by
  dest_device_id, span(timestamp, 600s, 300s) | where dest_user_original_artifact>=2  | rename window_end
  AS timestamp 
  | eval body=--body--
  | into write_ssa_finding_events();' 
how_to_implement: To successfully implement this detection, you need to be ingesting
  logon events from workstations.
known_false_positives: Shared workstations can cause false positives
references:
- https://attack.mitre.org/techniques/T1078/002/
tags:
  analytic_story:
  - Insider Threat
  cis20:
  - CIS 14
  confidence: 30
  context:
  - Source:Endpoint
  - Stage:Credential Access
  dataset:
  - https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1078.002/account_login/windows-security.log
  impact: 20
  kill_chain_phases:
  - Exploitation
  message: Multiple interactive logins detected on $device$
  mitre_attack_id:
  - T1078.002
  nist:
  - PR.AC
  - DE.AE
  observable:
  - name: device
    type: Hostname
    role:
    - Victim
  product:
  - Splunk Behavioral Analytics
  required_fields:
  - _time
  risk_score: 6
  risk_severity: low
  security_domain: access
  asset_type: Endpoint
