author: Teoderick Contreras, Mauricio Velazco, Splunk
datamodel:
- Endpoint
date: '2021-08-26'
description: This analytic looks for the execution of `net.exe` or `net1.exe` with
  command line arguments used to obtain the domain password policy. Red Teams and
  adversaries may leverage `net.exe` for situational awareness and Active Directory
  Discovery.
how_to_implement: To successfully implement this search, you need to be ingesting
  logs with the process name, parent process, and command-line executions from your
  endpoints. If you are using Sysmon, you must have at least version 6.0.4 of the
  Sysmon TA. Tune and filter known instances where renamed rundll32.exe may be used.
id: 09336538-065a-11ec-8665-acde48001122
known_false_positives: Administrators or power users may use this command for troubleshooting.
name: Password Policy Discovery with Net
references:
- https://github.com/S1ckB0y1337/Active-Directory-Exploitation-Cheat-Sheet
search: '| tstats `security_content_summariesonly` count min(_time) as firstTime max(_time)
  as lastTime from datamodel=Endpoint.Processes where (Processes.process_name="net.exe"
  OR Processes.process_name="net1.exe") AND Processes.process = "*accounts*" AND Processes.process
  = "*/domain*" by Processes.dest Processes.user Processes.parent_process Processes.process_name
  Processes.process Processes.process_id Processes.parent_process_id Processes.parent_process_name
  | `drop_dm_object_name(Processes)` | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)`
  | `password_policy_discovery_with_net_filter`'
tags:
  analytic_story:
  - Active Directory Discovery
  automated_detection_testing: passed
  confidence: 30
  context:
  - Source:Endpoint
  - Stage:Reconnaissance
  dataset:
  - https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1201/pwd_policy_discovery/windows-sysmon.log
  impact: 30
  kill_chain_phases:
  - Reconnaissance
  message: an instance of process $process_name$ with commandline $process$ in $dest$
  mitre_attack_id:
  - T1201
  observable:
  - name: user
    role:
    - Victim
    type: User
  - name: dest
    role:
    - Victim
    type: Hostname
  - name: parent_process_name
    role:
    - Parent Process
    type: Parent Process
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  required_fields:
  - Endpoint.Processes.dest
  - Endpoint.Processes.parent_process
  - Endpoint.Processes.parent_process_id
  - Endpoint.Processes.parent_process_name
  - Endpoint.Processes.process
  - Endpoint.Processes.process_id
  - Endpoint.Processes.process_name
  - Endpoint.Processes.user
  - _time
  risk_score: 9
  security_domain: endpoint
type: Hunting
version: 1
